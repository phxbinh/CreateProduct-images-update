<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Framework + Supabase + vercel</title>

<!-- Dùng cho MyTasks.js -->
<link rel="stylesheet" href="tasks.css">
<!---->

<!-- Dùng cho PublicTasks.js -->
<link rel="stylesheet" href="PublicTasks.css">
<!---->

<!-- Dùng cho RenderProducts.js -->
<link rel="stylesheet" href="productCard.css">
<!---->

<!-- Dùng cho RenderDetailProduct.js -->
<link rel="stylesheet" href="detailProduct.css">
<!---->

<!-- Dùng cho RenderProducts.js -->
<link rel="stylesheet" href="viewProduct.css">
<!---->

<!-- Dùng cho RenderProducts.js -->
<link rel="stylesheet" href="createProduct.css">
<!---->




  <style>

  </style>
</head>
<body>
  <div id="app"></div>

<!-- Framework -->
<script src="/framework/Debugger.js"></script>
<script src="/framework/vdom.js"></script>
<script src="/framework/hooks.js"></script>
<script src="/framework/router.js"></script>
<script src="/framework/init_API.js"></script>
<!---->

<!-- INIT SUPABASE TRƯỚC --
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const supabase = createClient(
    'https://defkqhylqphoqiikvbii.supabase.co', 'sb_publishable_vzdQpgqjLL2VE0Oyc0kEJQ_P8XqBwkh'
  );

  // Lưu vào window nếu cần các file khác dùng (không khuyến khích lắm, tốt nhất dùng import)
  window.supabase = supabase;

  console.log('Supabase client initialized');

  // Cách load script theo thứ tự và chờ nhau (cách đơn giản nhất)
  async function loadScriptsInOrder() {
    const scripts = [
      'Admin.js',         // cần user để test db
      'newProducts.js',
      'RenderProducts.js',
      'RenderDetailProduct.js',
      'AdminProductList.js',
      'AdminEditProductPage.js',
      'MyTasks.js',             // routing + UI cuối cùng
      'routesMenu.js'
    ];

    for (const src of scripts) {
      await new Promise((resolve, reject) => {
        const script = document.createElement('script');
        //script.type = 'module'; // rất quan trọng nếu file dùng import/export
        script.src = src;
        script.onload = () => {
          console.log(`Loaded: ${src}`);
          resolve();
        };
        script.onerror = () => {
          console.error(`Failed to load: ${src}`);
          reject();
        };
        document.body.appendChild(script);
      });
    }

    console.log('All core scripts loaded!');
    // Có thể dispatch event để báo cho app biết đã sẵn sàng
    window.dispatchEvent(new Event('app:ready'));
  }

  // Chạy sau khi supabase sẵn sàng
  loadScriptsInOrder().catch(err => {
    console.error('Critical error loading application scripts', err);
  });
</script>
<!---->



<!---->
<script type="module">
  // Import từ CDN phiên bản mới nhất của @supabase/ssr (hỗ trợ cookie)
  import { createBrowserClient } from 'https://cdn.jsdelivr.net/npm/@supabase/ssr@0.5.2/+esm';

  const supabase = createBrowserClient(
    'https://defkqhylqphoqiikvbii.supabase.co',
    'sb_publishable_vzdQpgqjLL2VE0Oyc0kEJQ_P8XqBwkh'  // anon key
  );

  window.supabase = supabase;

  console.log('Supabase browser client initialized with cookie persistence');

  // Phần load scripts giữ nguyên
  async function loadScriptsInOrder() {
    const scripts = [
      'Admin.js',
      'newProducts.js',
      'RenderProducts.js',
      'RenderDetailProduct.js',
      'AdminProductList.js',
      'AdminEditProductPage.js',
      'MyTasks.js',
      'AdminTasksCRUD.js',
      'routesMenu.js'
    ];

    for (const src of scripts) {
      await new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = () => {
          console.log(`Loaded: ${src}`);
          resolve();
        };
        script.onerror = () => {
          console.error(`Failed to load: ${src}`);
          reject();
        };
        document.body.appendChild(script);
      });
    }

    console.log('All core scripts loaded!');
    window.dispatchEvent(new Event('app:ready'));
  }

  loadScriptsInOrder().catch(err => {
    console.error('Critical error loading application scripts', err);
  });

  // Optional: Kiểm tra session ngay sau init để debug
  supabase.auth.getSession().then(({ data }) => {
    console.log('Session on init:', data.session ? 'Active' : 'None');
  });
</script>
<!---->

<!----
<script>
  // Force render test message sau 1s
  setTimeout(() => {
    const app = document.getElementById('app');
    if (app.innerHTML === '') {
      app.innerHTML = '<h1 style="color:red; text-align:center;">TEST: Trang không trắng nữa! Session có thể ok, nhưng logic render bị lỗi.</h1>';
    }
  }, 2000);
</script>
<!---->




</body>
</html>

<!----
https://framework-frontend-vdom-v01.vercel.app/postsnew
<!---->